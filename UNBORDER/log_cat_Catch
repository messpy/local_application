import os
import re
import xlwings as xw

def search_and_print(file_path, book):
    # ログファイルを開く
    with open(file_path, 'r', encoding='utf-8', errors='ignore') as file:
        content = file.read()
        lines = content.split('\n')

        # エクセルブックからC行とD行のワードを取得
        c_words = book.sheets[0].range('C:C').value
        d_words = book.sheets[0].range('D:D').value

        # 各行を検索
        c_matches = {word: 0 for word in c_words}
        d_matches = {word: 0 for word in d_words}

        for i, line in enumerate(lines, start=1):
            for c_word in c_words:
                if c_word and c_word in line:
                    c_matches[c_word] += 1

            for d_word in d_words:
                if d_word and d_word in line:
                    d_matches[d_word] += 1

        print_result(file_path, c_matches, d_matches)

def print_result(file_path, c_matches, d_matches):
    print(f"\n開始: {file_path}")
    print("C行のワード:")
    for word, count in c_matches.items():
        print(f"   {word}: {count} 件")

    print("D行のワード:")
    for word, count in d_matches.items():
        print(f"   {word}: {count} 件")

def process_folder(folder_path, book):
    for root, dirs, files in os.walk(folder_path):
        for file in files:
            if file.endswith(".log"):
                file_path = os.path.join(root, file)
                search_and_print(file_path, book)

# エクセルファイルのパス
excel_file_path = r"kent\Desktop\2.xlsx"
book = xw.Book(excel_file_path)

# ログフォルダを選択し処理を開始
folder_path = input("ログフォルダを入力してください: ")  # フォルダのパスを手動で入力
if os.path.isdir(folder_path):
    process_folder(folder_path, book)
    print("終了")
else:
    print("有効なフォルダを指定してください。")