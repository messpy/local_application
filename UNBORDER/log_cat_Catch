import tkinter as tk
from tkinter import filedialog
import os
import re

def search_and_print(file_path):
    with open(file_path, 'r', encoding='utf-8', errors='ignore') as file:
        content = file.read()
        lines = content.split('\n')

        # ①を探す
        matches_1 = re.finditer(r'ABC|DEFB|CAGE', content)
        for match_1 in matches_1:
            result_1 = match_1.group()

            # ②を探す
            matches_2 = re.finditer(r'abc|dcb|efc', content)
            for match_2 in matches_2:
                result_2 = match_2.group()

                # ファイル名、行数、結果を表示
                print(f"ファイル名: {file_path}")
                print(f"行数(①): {lines.index(match_1.group(0)) + 1}")
                print(f"①: {result_1}")
                print(f"行数(②): {lines.index(match_2.group(0)) + 1}")
                print(f"②: {result_2}")
                print("\n")

def process_folder(folder_path):
    for root, dirs, files in os.walk(folder_path):
        for file in files:
            if file.endswith(".log"):
                file_path = os.path.join(root, file)
                search_and_print(file_path)

def select_folder():
    root = tk.Tk()
    root.withdraw()

    folder_path = filedialog.askdirectory(title="フォルダを選択")
    if folder_path:
        process_folder(folder_path)

# フォルダ選択ダイアログを表示し、処理を開始
select_folder()